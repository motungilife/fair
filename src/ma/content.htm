<div x-data="handleContent()">
  <div class="content-card">
    <h2 class="card-title"> μ‚¬μ „ λ“±λ΅ </h2>
    <p class="card-text">
      μ²μ λ°•λν κ°€μ‹λ” 83%κ°€ λ†“μΉκ³  μλ μ‚¬μ‹¤!<br>
      μ‚¬μ „ λ“±λ΅, μΌμ •λ§ μ•λ©΄ λ†“μΉμ§€ μ•μµλ‹λ‹¤.!<br>
      μ§€κΈ λ°”λ΅ ν™•μΈν•κ³  ννƒ λ†“μΉμ§€ λ§μ„Έμ”!</p>
    <span class="card-icon">ποΈ</span>
  </div>
  <h2 class="section-title" id="aros1">μ‚¬μ „ λ“±λ΅ μ„λ°•, μ§€κΈ λ°”λ΅ μ‹ μ²­!</h2>
  <div class="support-grid">
    <template x-for="row in preUrls" :key="row.eventName">
      <a class="support-card" :class="getClsColor('blue')" :href="row.blogUrl">
        <div class="support-title" x-text="row.eventName"></div>
        <div class="support-subtitle" x-text="row.admissionFee"></div>
        <div class="support-icon" x-text="getTimeEmoji()"></div>
      </a>
    </template>
  </div>
  <div>
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9235956900770105"
      crossorigin="anonymous"></script> -->
    <!-- [λ””μ¤ν”λ μ΄, μ‚¬κ°ν•, λ°μ‘ν•] μ¤‘κ°„ -->
    <!-- <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9235956900770105" data-ad-slot="9852728268"
      data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script> -->
  </div>
  <h2 class="section-title">λ‹¤λ¥Έ ν–‰μ‚¬ μΌμ •μ΄ κ¶κΈν•μ‹λ‹¤λ©΄!</h2>
  <div class="support-grid">
    <template x-for="row in monthUrls" :key="row.month">
      <a class="support-card" :class="getClsColor('green')" :href="row.moonthUrl">
        <div class="support-title"><span x-text="row.month"></span>μ›”</div>
        <div class="support-subtitle" x-text="row.events"></div>
        <div class="support-icon" x-text="getMonthEmoji(row.month)"></div>
      </a>
    </template>
  </div>
  <h2 class="section-title" id="aros2">λ‹¤λ¥Έ μ§€μ—­ ν–‰μ‚¬λ„ ν™•μΈν•΄λ³΄μ„Έμ”!</h2>
  <div class="support-grid">
    <template x-for="row in regionUrls" :key="row.region">
      <a class="support-card" :class="getClsColor('purple')" :href="row.regionUrl">
        <div class="support-title" x-text="row.region"></div>
        <div class="support-subtitle" x-text="row.events"></div>
        <div class="support-icon" x-text="getRegionEmoji(row.region)"></div>
      </a>
    </template>
  </div>
  <h2 class="section-title" id="aros3">κ°€κΉμ΄ μ „μ‹μ¥ μ°Ύμ•„λ³΄μ„Έμ”!</h2>
  <div class="support-grid">
    <template x-for="row in venueUrls" :key="row.venue">
      <a class="support-card" :class="getClsColor('gold')" :href="row.venueUrl">
        <div class="support-title" x-text="row.venue"></div>
        <div class="support-subtitle" x-text="row.events"></div>
        <div class="support-icon" x-text="getVenueEmoji(row.venue)"></div>
      </a>
    </template>
  </div>
</div>
<script>
  function handleContent() {
    return {
      blogUrls: [],
      preUrls: [],
      monthUrls: [],
      regionUrls: [],
      venueUrls: [],
      async init() {
        const resBlogs = await fetch('/src/ma/blog_urls.json');
        this.blogUrls = await resBlogs.json();
        this.preUrls = this.blogUrls.filter(item => {
          const now = dayjs();
          const preregEndDate = dayjs('' + item.preregEndDate);
          return now.isBefore(preregEndDate) && now.startOf('month').isBefore(preregEndDate) && now.endOf('month').add(15, 'day').isAfter(preregEndDate);
        });

        this.preUrls = this.preUrls.map(item => {
          const now = dayjs();
          const preregEndDate = dayjs('' + item.preregEndDate);
          const daysLeft = preregEndDate.diff(now, 'day');
          return {
            ...item,
            admissionFee: `μ‚¬μ „ λ“±λ΅ λ§κ°μΌ : ${preregEndDate.format('YYYY.MM.DD')}`,
          };
        });

        const resMonths = await fetch('/src/ma/month_urls.json');
        const nowMonth = new Date().getMonth() + 1;
        this.monthUrls = (await resMonths.json()).filter(item => {
          return item.month >= nowMonth;
        }).map(item => {
          return {
            ...item,
            events: this.blogUrls.filter(blog => {
              return item.month === Number(dayjs('' + blog.scheduleStartDate).format('M'));
            }).map(blog => blog.eventName).join(', '),
          };
        }).filter(item => {
          return item.events.trim().length > 0;
        });

        const resRegions = await fetch('/src/ma/region_urls.json');
        this.regionUrls = (await resRegions.json()).map(item => {
          return {
            ...item,
            events: this.blogUrls.filter(blog => {
              return item.region === blog.eventRegion;
            }).map(blog => blog.eventName).join(', '),
          };
        }).filter(item => {
          return item.events.trim().length > 0;
        });

        const resVenues = await fetch('/src/ma/venue_urls.json');
        this.venueUrls = (await resVenues.json()).map(item => {
          return {
            ...item,
            events: this.blogUrls.filter(blog => {
              return item.venue === blog.eventVenue;
            }).map(blog => blog.eventName).join(', '),
          };
        }).filter(item => {
          return item.events.trim().length > 0;
        });
      },
    };
  }
</script>